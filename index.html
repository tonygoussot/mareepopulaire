---
layout: layout
title: La Marée populaire
social_title: La Marée populaire
social_type: website
social_description: Pour l’égalité, la justice sociale et la solidarité, marée populaire le samedi 26 mai
---
<link rel="stylesheet" href="{{ site.baseurl }}/public/leaflet/leaflet.css">
<script src="{{ site.baseurl }}/public/rxjs.umd.min.js"></script>
<script src="{{ site.baseurl }}/public/leaflet/leaflet.js"></script>

<div class="Intro">
    <div class="intro-col">
        <div class="Article card">
            <div class="Article__title">
                L'appel
            </div>
            <div class="Article__content Appel">
                <p class="Appel__intro">
                    Pour l’égalité, la justice sociale et la solidarité<br/>
                    <span class="Appel__intro__titre">Marée populaire le samedi 26 mai</span>
                </p>
                <p>
                    Un constat s’impose, Emmanuel Macron, son gouvernement et le Medef sont décidés à imposer coûte que
                    coûte une restructuration en profondeur de la société française : politique d’austérité, destruction
                    des droits des salarié.es, introduction de la sélection à l’entrée de l’université, casse des
                    services publics, aggravation du sort des sans emplois, réorganisation aggravant les inégalités en
                    matière d’accès à la justice, réforme fiscale favorable aux plus riches, loi répressive contre les
                    migrant.es, priorité donnée au secret des affaires contre le droit à l’information, introduction de
                    l’état d’urgence dans le droit commun, répression des mouvements sociaux et des jeunes des quartiers
                    populaires, utilisation de l'égalité femmes-hommes comme simple outil de communication, sans moyens
                    financiers, alors que les femmes sont les premières concernées par les régressions sociales… sans
                    oublier une politique militariste au niveau international. La multiplication des mesures prises avec
                    brutalité sur tous les fronts a un objectif, celui de créer un effet de sidération et espérer ainsi
                    empêcher toute riposte. Le patronat profite de la situation pour multiplier les restructurations et
                    rester sourd aux revendications du monde du travail. En s’en prenant aux personnels à statut, en
                    particulier aux cheminot.es, Emmanuel Macron espère, s’il l’emporte, casser tout esprit de
                    résistance.
                </p>
                <p>
                    Ce coup de force peut échouer, car les mobilisations se multiplient dans le pays, chacune avec sa
                    spécificité : journée nationale d’action, grèves, occupation d’universités, manifestations… Il
                    appartient évidemment aux organisations syndicales de décider, avec les personnels concernés, de
                    leurs formes d’action. Chacune d’entre elles a, a priori, des ressorts différents, mais au-delà de
                    tel ou tel aspect, ce dont il est question concerne la nature même de la société dans laquelle nous
                    voulons vivre. Voulons-nous vivre dans une société où les droits sociaux seraient réduits à néant,
                    où les services publics et la sécurité sociale auraient disparu, où l’inégalité de traitement des
                    territoires serait la règle, où l’accès à l’université serait de plus en plus réduit, où les
                    lanceuses et lanceurs d’alerte et journalistes seraient bâillonnés, où les défis écologiques
                    seraient soumis aux intérêts de la finance, où le logement, les HLM et les locataires seraient
                    marchandises, où la lutte contre les discriminations se réduit à des discours ? Ou, au contraire,
                    voulons-nous une société plus juste, plus solidaire, plus démocratique, plus égalitaire avec un
                    meilleur partage des richesses ? Tel est l’enjeu.
                </p>
                <p>
                    Le gouvernement espère que ces mobilisations sectorielles restent isolées et qu’il pourra les
                    défaire les unes après les autres en tenant bon, en les laissant s’épuiser ou en les réprimant.
                    Affichant sa détermination, il espère ainsi nous décourager. Il se trompe, comme le montre la
                    multiplication des collectifs citoyens en lien avec les salarié.es, les retraité.es et les
                    étudiant.es ainsi que le succès de la solidarité aux grévistes, notamment à ceux de la SNCF. Il
                    s’agit maintenant d’aller plus loin et, toutes et tous ensemble, d’affirmer dans la rue que des
                    alternatives existent, que nous ne nous résignons pas au sort que nous promet ce gouvernement. Il
                    fait la sourde oreille, il faut le forcer à nous entendre et à retirer ses projets.
                </p>
                <p>
                    Dans le respect de nos champs d’interventions respectifs, nous voulons aller au-delà de toutes les
                    mobilisations positives qui existent déjà et rassembler toutes les forces sociales, syndicales,
                    associatives, politiques pour construire et réussir ensemble un grand rendez-vous citoyen. Partout
                    en France organisons le samedi 26 mai une marée populaire pour l’égalité, la justice sociale et la
                    solidarité.
                </p>
            </div>
        </div>
    </div>
    <div class="intro-col">
        <div class="Article card">
            <div class="Article__title">
                La marée populaire près de chez vous
            </div>
            <div class="Article__content Carte">
                <div class="Carte__vue" id="carte-marees"></div>
                <form>
                    <label for="commune">Cherchez une marée populaire près de chez vous</label>
                    <input type="text" id="commune" placeholder="Indiquez votre commune" autocomplete="off">
                </form>
                <div class="Carte__resultats">
                    <ul style="display: none;"></ul>
                </div>
            </div>
        </div>
        <div class="Article card">
            <div class="Article__title">
                Partagez ce site sur les réseaux sociaux
            </div>
            <div class="Article__content Social">
                <a class="Social__Button Social__Button--fa"
                   href="https://www.facebook.com/sharer/sharer.php?u=https%3A//mareepopulaire.fr">
                    <img class="SocialImage SocialImage--big" src="{{ site.baseurl }}/public/img/fa-white.svg"
                         alt="Facebok">
                    Facebook
                </a>
                <a class="Social__Button Social__Button--tw"
                   href="https://twitter.com/home?status=Le%205%20mai,%20c'est%20la%20mar%C3%A9e%20populaire%0Amareepopulaire.fr">
                    <img class="SocialImage SocialImage--big" src="{{ site.baseurl }}/public/img/twitter-white.svg"
                         alt="Twitter">
                    Twitter
                </a>
                <script>
                  function socialClick(e) {
                    window.open(e.currentTarget.href, 'social', 'width=600,height=600,menubar=no,toolbar=no');
                    e.preventDefault();
                  }

                  document.querySelectorAll('.Social__Button').forEach(function (link) {
                    link.addEventListener('click', socialClick);
                  })
                </script>
            </div>
        </div>

        <div class="Article card">
            <div class="Article__title">
                L'affiche
            </div>
            <div class="Article__content">
                <a href="{{ site.baseurl }}/public/files/affiche_unitaire.pdf">
                    <img src="{{ site.baseurl }}/public/img/affiche_unitaire_lq.png" alt="Affiche unitaire"/>
                </a>
            </div>
        </div>
        <div class="Article card">
            <div class="Article__title">
                Retrouvons-nous sur les réseaux sociaux
            </div>
            <div class="Article__action rs">
                <a class="Article__action--link" href="https://www.facebook.com/mareepopulaire/" target="_blank">
                    <img class="SocialImage SocialImage--small" src="{{ site.baseurl }}/public/img/fa.svg"> La page
                    Facebook</a>
            </div>
            <div class="Article__action rs">
                <a class="Article__action--link" href="https://twitter.com/mareepopulaire" target="_blank">
                    <img class="SocialImage SocialImage--small" src="{{ site.baseurl }}/public/img/twitter.svg"> Le fil
                    Twitter</a>
            </div>
        </div>
        <div class="Article card">
            <div class="Article__title">
                Les signataires
            </div>
            <div class="Article__content Article__content--signataires">
                <ul class="Signataires">
                    {% for signataire in site.data.signataires %}
                    <li>{{ signataire.nom }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
  var events = {{ site.data.carte | jsonify }};

  var map = rxjs.operators.map;
  var filter = rxjs.operators.filter;
  var merge = rxjs.operators.merge;
  var debounceTime = rxjs.operators.debounceTime;
  var switchMap = rxjs.operators.switchMap;
  var switchMapTo = rxjs.operators.switchMapTo;
  var startWith = rxjs.operators.startWith;

  var leafletMap = L.map('carte-marees').setView([46.76996843356982, 3.251953125], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Contributeurs <a href="https://www.openstreemap.org">OpenStreetMap</a>',
    maxZoom: 17
  }).addTo(leafletMap);

  events.forEach(function (event) {
    event.marker = L.marker([event.coordinates.lat, event.coordinates.lon]).addTo(leafletMap);
    event.marker.bindPopup(
      '<h3>La marée populaire ' + event.title + '</h3>' +
      '<p>' + event.description + '</p>'
    );
  });

  var rad = Math.PI / 180;

  var input = document.getElementById('commune');
  var form = input.parentNode;
  var list = document.querySelector('.Carte__resultats ul');

  // prevent default behaviour for submit / click
  form.addEventListener('submit', function (e) {
    e.preventDefault();
  });
  list.addEventListener('click', function (e) {
    e.preventDefault();
  });
  form.parentNode.addEventListener('click', function(e) {
    e.stopPropagation();
  });

  // observable that fires when form is submitted (with enter)
  var submit$ = rxjs.fromEvent(form, 'submit').pipe(
    map(function (e) {
      return input.value;
    })
  );

  // observable that fire whenever the value in the input field changes
  var change$ = rxjs.fromEvent(input, 'input').pipe(
    map(function (e) {
      return input.value;
    })
  );

  // debounced version of change$ that won't fire if there has been a submit
  var debouncedChange$ = submit$.pipe(
    startWith(null),
    switchMapTo(change$.pipe(debounceTime(300)))
  );

  // observable that fire whenever a place is clicked ; value is the coordinates
  var listClick$ = rxjs.fromEvent(list, 'click').pipe(
    filter(function (e) {
      return !!e.target.dataset.x;
    }),
    map(function (e) {
      return L.latLng([+e.target.dataset.y, +e.target.dataset.x]);
    })
  );

  listClick$.subscribe(function (latLng) {
    const event = closestEvent(latLng);
    event.marker.openPopup();
    leafletMap.setView([event.coordinates.lat, event.coordinates.lon], 10);
  });

  var autoCompletionResults$ = listClick$.pipe(
    startWith(null),
    merge(rxjs.fromEvent(document, 'click')),
    switchMap(function() {
      return debouncedChange$.pipe(
        merge(submit$),
        switchMap(chercheCommune),
        startWith(null)
      )
    })
  );

  autoCompletionResults$.subscribe(function (results) {
    if (results === null) {
      list.style.display = 'none';
      return;
    }

    list.style.display = 'block';

    if (results.length) {
      list.innerHTML = results.slice(0, 5).map(function (r) {
        return '<li><a href="#" data-x="' + r.centre.coordinates[0] + '" data-y="' + r.centre.coordinates[1] + '">' +
          r.nom + ' (' + r.codeDepartement + ')</a></li>'
      }).join('');
    } else {
      list.innerHTML = '<li><a href="#">Pas de résultats pour cette recherche.</a></li>';
    }
  }, function(error) {
    list.style.display = 'block';
    list.innerHTML = '<li><a href="#">Problème de connexion...</a></li>';
  });

  function chercheCommune(nom) {
    if (!nom.trim()) {
        return rxjs.of(null);
    }

    var url = 'https://geo.api.gouv.fr/communes?nom=' + encodeURIComponent(nom) +
      '&fields=nom,centre,codeDepartement&format=json&geometry=centre';
    var headers = new Headers();
    headers.append('Accept', 'application/json');

    return rxjs.from(fetch(url, {headers: headers}).then(function (res) {
      if (!res.ok) {
        throw new Error('Problème de chargement');
      }
      return res.json();
    }));
  }

  const eligibleEvents = events.filter(function (e) {
    return !e.depart;
  });

  function closestEvent(latLng) {
    var d, minEvent, minDistance = Infinity;

    eligibleEvents.forEach(function (e) {
      d = haversineDistance(latLng, e.coordinates);
      if (d < minDistance) {
        minDistance = d;
        minEvent = e;
      }
    });

    return minEvent;
  }

  // HAVERSINE DISTANCE
  var atan2 = Math.atan2;
  var cos = Math.cos;
  var sin = Math.sin;
  var sqrt = Math.sqrt;
  var PI = Math.PI;

  // (mean) radius of Earth (meters)
  var R = 6378137;

  function squared(x) {
    return x * x
  }

  function toRad(x) {
    return x * PI / 180.0
  }

  // https://stackoverflow.com/questions/1502590/calculate-distance-between-two-points-in-google-maps-v3
  function haversineDistance(a, b) {
    var aLat = a.latitude || a.lat;
    var bLat = b.latitude || b.lat;
    var aLng = a.longitude || a.lng || a.lon;
    var bLng = b.longitude || b.lng || b.lon;

    var dLat = toRad(bLat - aLat);
    var dLon = toRad(bLng - aLng);

    var f = squared(sin(dLat / 2.0)) + cos(toRad(aLat)) * cos(toRad(bLat)) * squared(sin(dLon / 2.0));
    var c = 2 * atan2(sqrt(f), sqrt(1 - f));

    return R * c;
  }
</script>
